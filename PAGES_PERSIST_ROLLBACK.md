# Кастомные страницы в startbar — мини-механизм и откат

## Что сделано (минимум)

- **Бэкенд:** при запросе списка страниц (`GET /api/pages/list`) список собирается из реестра `.generated_pages.json` **и** из реальных файлов `templates/pages/*.html` (кроме системных и `_*`). Если в папке есть страница, которой нет в реестре, она добавляется в список и реестр обновляется. Так после обновления страницы или потери JSON список в startbar не пустеет.
- Системные шаблоны (index, deals, auth-*, ui-*, и т.д.) в список кастомных страниц не попадают.

## Что менять на сервере

1. **Файл:** `apps/pages/routes.py`
   - Подставить обновлённую версию (или применить те же правки, что в репозитории).
2. **Перезапуск:** перезапустить приложение (gunicorn/uwsgi/run.py), чтобы подтянуть новый код.
3. **Файловая система:** папка `apps/templates/pages/` должна быть доступна на запись (для обновления `.generated_pages.json` при первом после-обновления запросе списка страниц).

## Как проверить, что работает

1. Открыть любой экран приложения (главная, deals и т.п.).
2. В startbar нажать «+ Добавить страницу», ввести название (например «Тест 1»), создать.
3. Убедиться, что открылась новая страница и в меню «Custom Pages» появился пункт «Тест 1».
4. Обновить страницу (F5 или обновление в браузере).
5. Снова открыть startbar — пункт «Тест 1» должен остаться в списке.
6. Опционально: перезапустить приложение и снова открыть сайт — пункт «Тест 1» по-прежнему в списке.
7. Проверить API вручную: `GET /api/pages/list` — в ответе в `pages` должна быть созданная страница.

## Как откатиться

1. В **`apps/pages/routes.py`** вернуть старую логику:
   - Удалить константу `_SYSTEM_PAGE_STEMS` и функцию `_list_pages_with_fallback`.
   - В `list_pages()` снова вызывать только `_read_registry()` и возвращать `registry`:
     ```python
     @blueprint.route('/api/pages/list')
     def list_pages():
         """Return list of generated pages for sidebar."""
         registry = _read_registry()
         return jsonify({"ok": True, "pages": registry})
     ```
2. Сохранить файл и перезапустить приложение.

После отката список страниц снова берётся только из `.generated_pages.json` (как было до изменений).

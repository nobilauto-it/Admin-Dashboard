{% extends "layouts/base.html" %}

{% block html_attribute %}{% endblock %}

{% block title %}{% endblock %}

{% block body_attribute %}{% if is_dashboard_page|default(false) %} class="page-dashboard-readonly"{% endif %}{% endblock %}

{% block styles %}
<style>
/* Для гостей (не залогинен): скрыть тулбар, кнопку «Добавить» (таблицу/карточку), шестерёнки. Залогиненный админ видит всё. */
.dashboard-toolbar-hidden,
body.page-dashboard-readonly #entityTableAdminToolbar,
body.page-dashboard-readonly #topbarBtnAddEntityWrap,
body.page-dashboard-readonly .btnAddEntityInSection,
body.page-dashboard-readonly .btnFieldsInSection { display: none !important; }
/* Скрыть кнопку «плюс» (добавить сущность) везде — во всех блоках таблиц */
.btn.btn-primary.btn-plus-content.btnAddEntityInSection,
.btnAddEntityInSection { display: none !important; }
body.page-dashboard-readonly .d-flex.justify-content-end.align-items-center.gap-2.mb-2:has(#topbarBtnAddEntityWrap) { display: none !important; }
</style>
{% endblock styles %}

{% block content %}

{% include "partials/topbar.html" %}

{% include "partials/startbar.html" %}

<div class="page-wrapper">

    <div class="page-content">

        <div class="container-fluid">

            {% block page_content %}{% endblock %}

        </div>

        {% include "partials/endbar.html" %}

        {% include "partials/footer.html" %}

    </div>

</div>


{% endblock %}

{% block javascripts %} {% endblock javascripts %}
<script>
(function() {
    var isGuest = false;
    try { isGuest = !localStorage.getItem('auth_user_id'); } catch (e) { isGuest = true; }
    if (isGuest) document.body.classList.add('page-dashboard-readonly');
    else { document.body.classList.remove('page-dashboard-readonly'); document.body.classList.add('page-user-logged-in'); }
    function hideDashboardToolbar() {
        if (!document.body.classList.contains('page-dashboard-readonly')) return;
        var t = document.getElementById('entityTableAdminToolbar');
        if (t) { t.style.setProperty('display', 'none', 'important'); t.classList.add('dashboard-toolbar-hidden'); }
        var bAddWrap = document.getElementById('topbarBtnAddEntityWrap');
        if (bAddWrap) { bAddWrap.style.setProperty('display', 'none', 'important'); bAddWrap.classList.add('dashboard-toolbar-hidden'); }
        var c = document.getElementById('entityTablesContainer');
        if (c) c.querySelectorAll('.btnAddEntityInSection, .btnFieldsInSection').forEach(function(el) { el.style.setProperty('display', 'none', 'important'); el.classList.add('dashboard-toolbar-hidden'); });
    }
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', hideDashboardToolbar);
    } else {
        hideDashboardToolbar();
    }
    setTimeout(hideDashboardToolbar, 100);
    setTimeout(hideDashboardToolbar, 500);
    var interval = setInterval(hideDashboardToolbar, 400);
    setTimeout(function() { clearInterval(interval); }, 5000);
})();
</script>